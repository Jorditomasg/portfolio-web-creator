<div class="animate-fade-in p-8">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-2xl font-bold text-white">Gesti√≥n de Experiencia</h1>
    
    <button (click)="openModal()" class="px-4 py-2 bg-primary hover:bg-primary-dark text-dark-bg font-medium rounded-lg transition-colors flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
      </svg>
      Nueva Experiencia
    </button>
  </div>

  <!-- Experience List with Drag-Drop -->
  <div class="space-y-4" cdkDropList (cdkDropListDropped)="drop($event)">
    @for (exp of sortedExperiences(); track exp.id) {
      <div cdkDrag
           class="bg-dark-surface rounded-xl border border-dark-border p-6 hover:border-primary/50 transition-colors group">
        <div class="flex justify-between items-start">
          <!-- Drag Handle -->
          <div cdkDragHandle class="cursor-move p-2 -ml-2 -mt-2 mr-2 text-gray-500 hover:text-gray-300 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/>
            </svg>
          </div>

          <!-- Logo -->
          <div class="flex-shrink-0 mr-4">
            <div class="w-12 h-12 rounded-lg bg-dark-bg border border-dark-border flex items-center justify-center text-2xl overflow-hidden">
              @if (exp.company_logo) {
                <img [src]="exp.company_logo" [alt]="exp.company" class="w-full h-full object-cover">
              } @else {
                <span>üè¢</span>
              }
            </div>
          </div>

          <div class="flex-1">
            <div class="flex items-center gap-2">
              <h3 class="text-lg font-semibold text-white group-hover:text-primary transition-colors">{{ exp.title }}</h3>
              @if (exp.is_current) {
                <span class="px-2 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-full">Actual</span>
              }
            </div>
            <p class="text-gray-400 text-sm font-medium">{{ exp.company }} <span class="mx-2 text-dark-border">|</span> {{ exp.period }}</p>
            
            <p class="text-gray-300 mt-2 text-sm leading-relaxed">{{ exp.description }}</p>
            
            @if (exp.achievements?.length) {
              <ul class="mt-3 space-y-1">
                @for (achievement of exp.achievements; track achievement) {
                  <li class="text-sm text-gray-400 flex items-start gap-2">
                    <span class="text-primary mt-1.5 w-1 h-1 rounded-full bg-primary block"></span>
                    <span>{{ achievement }}</span>
                  </li>
                }
              </ul>
            }
          </div>

          <!-- Actions -->
          <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
            <button (click)="edit(exp)" class="p-2 text-gray-400 hover:text-white hover:bg-dark-bg rounded-lg transition-colors" title="Editar">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
            </button>
            <button (click)="deleteExp(exp.id)" class="p-2 text-gray-400 hover:text-red-400 hover:bg-dark-bg rounded-lg transition-colors" title="Eliminar">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    } @empty {
      <div class="text-center py-12 text-gray-500 bg-dark-surface rounded-xl border border-dashed border-dark-border">
        No hay experiencias registradas. ¬°A√±ade tu primera experiencia laboral!
      </div>
    }
  </div>

  <!-- Modal -->
  @if (showModal()) {
    <div class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in">
      <div class="bg-dark-surface w-full max-w-2xl rounded-2xl border border-dark-border shadow-2xl flex flex-col max-h-[90vh]">
        
        <div class="p-6 border-b border-dark-border flex justify-between items-center">
          <h2 class="text-xl font-bold text-white">
            {{ editing() ? 'Editar Experiencia' : 'Nueva Experiencia' }}
          </h2>
          <button (click)="closeModal()" class="text-gray-400 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <div class="p-6 overflow-y-auto custom-scrollbar">
          <form (ngSubmit)="save()" class="space-y-6">
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">T√≠tulo del puesto / Rol</label>
                <input type="text" [(ngModel)]="form.title" name="title" required
                       class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white transition-colors"
                       placeholder="Ej: Senior Frontend Developer">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Title (English)</label>
                <input type="text" [(ngModel)]="form.title_en" name="title_en" 
                       class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white transition-colors"
                       placeholder="Ex: Senior Frontend Developer">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Empresa</label>
                <div class="flex gap-3">
                  <div class="relative flex-1">
                    <input type="text" [(ngModel)]="form.company" name="company" required
                           class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white transition-colors"
                           placeholder="Ej: Google">
                  </div>
                  <div class="relative w-1/3">
                    <input type="text" [(ngModel)]="form.company_logo" name="company_logo"
                           class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white transition-colors"
                           placeholder="URL Logo (opcional)">
                  </div>
                </div>
              </div>

              <!-- Current Job Toggle -->
              <div class="flex items-center gap-3 p-3 bg-dark-bg rounded-lg border border-dark-border">
                <input type="checkbox" [(ngModel)]="form.is_current" name="is_current" id="is_current"
                       class="w-5 h-5 rounded border-dark-border bg-dark-bg text-primary focus:ring-primary">
                <label for="is_current" class="text-gray-300 font-medium cursor-pointer">Trabajo actual</label>
              </div>
              
              <!-- Date Fields -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-400 mb-1">Fecha inicio</label>
                  <input type="month" [(ngModel)]="form.start_date" name="start_date" required
                         class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white transition-colors text-sm">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-400 mb-1">Fecha fin</label>
                  <input type="month" [(ngModel)]="form.end_date" name="end_date" [disabled]="form.is_current" [required]="!form.is_current"
                         class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                         placeholder="Presente si es trabajo actual">
                </div>
              </div>

            </div>

            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Descripci√≥n (Espa√±ol)</label>
                <textarea [(ngModel)]="form.description" name="description" rows="3"
                          class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white resize-none transition-colors"
                          placeholder="Breve descripci√≥n de las responsabilidades principales..."></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Description (English)</label>
                <textarea [(ngModel)]="form.description_en" name="description_en" rows="3"
                          class="w-full px-4 py-2.5 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white resize-none transition-colors"
                          placeholder="Brief description of main responsibilities..."></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Logros destacados (Espa√±ol, uno por l√≠nea)</label>
                <textarea [(ngModel)]="form.achievementsText" name="achievements" rows="3"
                          class="w-full px-4 py-2 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white resize-none font-mono text-sm"
                          placeholder="Lider√© un equipo de 5 desarrolladores&#10;Reduje la latencia en un 40%..."></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Achievements (English, one per line)</label>
                <textarea [(ngModel)]="form.achievementsTextEn" name="achievements_en" rows="3"
                          class="w-full px-4 py-2 bg-dark-bg border border-dark-border rounded-lg focus:border-primary outline-none text-white resize-none font-mono text-sm"
                          placeholder="Led a team of 5 developers&#10;Reduced latency by 40%..."></textarea>
              </div>
            </div>

            <div class="flex justify-end gap-3 pt-4 border-t border-dark-border">
              <button type="button" (click)="closeModal()" class="px-5 py-2.5 text-gray-400 hover:text-white transition-colors font-medium">
                Cancelar
              </button>
              <button type="submit" [disabled]="isSaving()" 
                      class="px-6 py-2.5 bg-primary hover:bg-primary-dark text-dark-bg font-medium rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                @if (isSaving()) {
                  <svg class="animate-spin h-5 w-5 text-dark-bg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Guardando...
                } @else {
                  Guardar Experiencia
                }
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  }
</div>

